/**
 * turn.js 3rd release
 * www.turnjs.com
 *
 * Copyright (C) 2012, Emmanuel Garcia.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *
 * 2. Any redistribution, use, or modification is done solely for personal 
 * benefit and not for any commercial purpose or for monetary gain.
 * 
 **/
(function(e){"use strict";var t,n="",r=Math.PI,i=r/2,s="ontouchstart"in window,o=s?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},u={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br"]},a=["single","double"],f={page:1,gradients:true,duration:600,acceleration:true,display:"double",when:null},l={folding:null,corners:"forward",cornerSize:100,gradients:true,duration:600,acceleration:true},c=6,h={0:{top:0,left:0,right:"auto",bottom:"auto"},1:{top:0,right:0,left:"auto",bottom:"auto"}},p=function(e,t,n,r){return{css:{position:"absolute",top:e,left:t,overflow:r||"hidden","z-index":n||"auto"}}},d=function(e,t,n,r,i){var s=1-i,o=s*s*s,u=i*i*i;return g(Math.round(o*e.x+3*i*s*s*t.x+3*i*i*s*n.x+u*r.x),Math.round(o*e.y+3*i*s*s*t.y+3*i*i*s*n.y+u*r.y))},v=function(e){return e/180*r},m=function(e){return e/r*180},g=function(e,t){return{x:e,y:t}},y=function(e,n,r){return t&&r?" translate3d("+e+"px,"+n+"px, 0px) ":" translate("+e+"px, "+n+"px) "},b=function(e){return" rotate("+e+"deg) "},w=function(e,t){return Object.prototype.hasOwnProperty.call(t,e)},E=function(){var e=["Moz","Webkit","Khtml","O","ms"],t=e.length,n="";while(t--)if(e[t]+"Transform"in document.body.style)n="-"+e[t].toLowerCase()+"-";return n},S=function(e,t,r,i,s){var o,u=[];if(n=="-webkit-"){for(o=0;o<s;o++)u.push("color-stop("+i[o][0]+", "+i[o][1]+")");e.css({"background-image":"-webkit-gradient(linear, "+t.x+"% "+t.y+"%,  "+r.x+"% "+r.y+"%, "+u.join(",")+" )"})}else{t={x:t.x/100*e.width(),y:t.y/100*e.height()};r={x:r.x/100*e.width(),y:r.y/100*e.height()};var a=r.x-t.x,f=r.y-t.y,l=Math.atan2(f,a),c=l-Math.PI/2,h=Math.abs(e.width()*Math.sin(c))+Math.abs(e.height()*Math.cos(c)),p=Math.sqrt(f*f+a*a),d=g(r.x<t.x?e.width():0,r.y<t.y?e.height():0),v=Math.tan(l),m=-1/v,y=(m*d.x-d.y-v*t.x+t.y)/(m-v),b={x:y,y:m*y-m*d.x+d.y},w=Math.sqrt(Math.pow(b.x-t.x,2)+Math.pow(b.y-t.y,2));for(o=0;o<s;o++)u.push(" "+i[o][1]+" "+(w+p*i[o][0])*100/h+"%");e.css({"background-image":n+"linear-gradient("+ -l+"rad,"+u.join(",")+")"})}},x={init:function(r){if(t===undefined){t="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;n=E()}var i,a=this.data(),l=this.children();r=e.extend({width:this.width(),height:this.height()},f,r);a.opts=r;a.pageObjs={};a.pages={};a.pageWrap={};a.pagePlace={};a.pageMv=[];a.totalPages=r.pages||0;if(r.when)for(i in r.when)if(w(i,r.when))this.bind(i,r.when[i]);this.css({position:"relative",width:r.width,height:r.height});this.turn("display",r.display);if(t&&!s&&r.acceleration)this.transform(y(0,0,true));for(i=0;i<l.length;i++)this.turn("addPage",l[i],i+1);this.turn("page",r.page);u=e.extend({},u,r.corners);e(this).bind(o.start,function(e){for(var t in a.pages)if(w(t,a.pages)&&T._eventStart.call(a.pages[t],e)===false)return false});e(document).bind(o.move,function(e){for(var t in a.pages)if(w(t,a.pages))T._eventMove.call(a.pages[t],e)}).bind(o.end,function(e){for(var t in a.pages)if(w(t,a.pages))T._eventEnd.call(a.pages[t],e)});a.done=true;return this},addPage:function(t,n){var r=false,i=this.data(),s=i.totalPages+1;if(n){if(n==s){n=s;r=true}else if(n>s)throw new Error('It is impossible to add the page "'+n+'", the maximum value is: "'+s+'"')}else{n=s;r=true}if(n>=1&&n<=s){if(i.done)this.turn("stop");if(n in i.pageObjs)x._movePages.call(this,n,1);if(r)i.totalPages=s;i.pageObjs[n]=e(t).addClass("turn-page p"+n);x._addPage.call(this,n);if(i.done)this.turn("update");x._removeFromDOM.call(this)}return this},_addPage:function(t){var n=this.data(),r=n.pageObjs[t];if(r)if(x._necessPage.call(this,t)){if(!n.pageWrap[t]){var i=n.display=="double"?this.width()/2:this.width(),s=this.height();r.css({width:i,height:s});n.pagePlace[t]=t;n.pageWrap[t]=e("<div/>",{"class":"turn-page-wrapper",page:t,css:{position:"absolute",overflow:"hidden",width:i,height:s}}).css(h[n.display=="double"?t%2:0]);this.append(n.pageWrap[t]);n.pageWrap[t].prepend(n.pageObjs[t])}if(!t||x._setPageLoc.call(this,t)==1)x._makeFlip.call(this,t)}else{n.pagePlace[t]=0;if(n.pageObjs[t])n.pageObjs[t].remove()}},hasPage:function(e){return e in this.data().pageObjs},_makeFlip:function(e){var t=this.data();if(!t.pages[e]&&t.pagePlace[e]==e){var n=t.display=="single",r=e%2;t.pages[e]=t.pageObjs[e].css({width:n?this.width():this.width()/2,height:this.height()}).flip({page:e,next:n&&e===t.totalPages?e-1:r||n?e+1:e-1,turn:this,duration:t.opts.duration,acceleration:t.opts.acceleration,corners:n?"all":r?"forward":"backward",backGradient:t.opts.gradients,frontGradient:t.opts.gradients}).flip("disable",t.disabled).bind("pressed",x._pressed).bind("released",x._released).bind("start",x._start).bind("end",x._end).bind("flip",x._flip)}return t.pages[e]},_makeRange:function(){var e,t=this.data(),n=this.turn("range");for(e=n[0];e<=n[1];e++)x._addPage.call(this,e)},range:function(e){var t,n,r,i=this.data();e=e||i.tpage||i.page;var s=x._view.call(this,e);if(e<1||e>i.totalPages)throw new Error('"'+e+'" is not a page for range');s[1]=s[1]||s[0];if(s[0]>=1&&s[1]<=i.totalPages){t=Math.floor((c-2)/2);if(i.totalPages-s[1]>s[0]){n=Math.min(s[0]-1,t);r=2*t-n}else{r=Math.min(i.totalPages-s[1],t);n=2*t-r}}else{n=c-1;r=c-1}return[Math.max(1,s[0]-n),Math.min(i.totalPages,s[1]+r)]},_necessPage:function(e){if(e===0)return true;var t=this.turn("range");return e>=t[0]&&e<=t[1]},_removeFromDOM:function(){var e,t=this.data();for(e in t.pageWrap)if(w(e,t.pageWrap)&&!x._necessPage.call(this,e))x._removePageFromDOM.call(this,e)},_removePageFromDOM:function(e){var t=this.data();if(t.pages[e]){var n=t.pages[e].data();if(n.f&&n.f.fwrapper)n.f.fwrapper.remove();t.pages[e].remove();delete t.pages[e]}if(t.pageObjs[e])t.pageObjs[e].remove();if(t.pageWrap[e]){t.pageWrap[e].remove();delete t.pageWrap[e]}delete t.pagePlace[e]},removePage:function(e){var t=this.data();if(t.pageObjs[e]){this.turn("stop");x._removePageFromDOM.call(this,e);delete t.pageObjs[e];x._movePages.call(this,e,-1);t.totalPages=t.totalPages-1;x._makeRange.call(this);if(t.page>t.totalPages)this.turn("page",t.totalPages)}return this},_movePages:function(e,t){var n,r=this.data(),i=r.display=="single",s=function(e){var n=e+t,s=n%2;if(r.pageObjs[e])r.pageObjs[n]=r.pageObjs[e].removeClass("page"+e).addClass("page"+n);if(r.pagePlace[e]&&r.pageWrap[e]){r.pagePlace[n]=n;r.pageWrap[n]=r.pageWrap[e].css(h[i?0:s]).attr("page",n);if(r.pages[e])r.pages[n]=r.pages[e].flip("options",{page:n,next:i||s?n+1:n-1,corners:i?"all":s?"forward":"backward"});if(t){delete r.pages[e];delete r.pagePlace[e];delete r.pageObjs[e];delete r.pageWrap[e];delete r.pageObjs[e]}}};if(t>0)for(n=r.totalPages;n>=e;n--)s(n);else for(n=e;n<=r.totalPages;n++)s(n)},display:function(t){var n=this.data(),r=n.display;if(t){if(e.inArray(t,a)==-1)throw new Error('"'+t+'" is not a value for display');if(t=="single"){if(!n.pageObjs[0]){this.turn("stop").css({overflow:"hidden"});n.pageObjs[0]=e("<div />",{"class":"turn-page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)}}else{if(n.pageObjs[0]){this.turn("stop").css({overflow:""});n.pageObjs[0].remove();delete n.pageObjs[0]}}n.display=t;if(r){var i=this.turn("size");x._movePages.call(this,1,0);this.turn("size",i.width,i.height).turn("update")}return this}else return r},animating:function(){return this.data().pageMv.length>0},disable:function(t){var n,r=this.data(),i=this.turn("view");r.disabled=t===undefined||t===true;for(n in r.pages)if(w(n,r.pages))r.pages[n].flip("disable",t?e.inArray(n,i):false);return this},size:function(e,t){if(e&&t){var n=this.data(),r=n.display=="double"?e/2:e,i;this.css({width:e,height:t});if(n.pageObjs[0])n.pageObjs[0].css({width:r,height:t});for(i in n.pageWrap){if(!w(i,n.pageWrap))continue;n.pageObjs[i].css({width:r,height:t});n.pageWrap[i].css({width:r,height:t});if(n.pages[i])n.pages[i].css({width:r,height:t})}this.turn("resize");return this}else{return{width:this.width(),height:this.height()}}},resize:function(){var e,t=this.data();if(t.pages[0]){t.pageWrap[0].css({left:-this.width()});t.pages[0].flip("resize",true)}for(e=1;e<=t.totalPages;e++)if(t.pages[e])t.pages[e].flip("resize",true)},_removeMv:function(e){var t,n=this.data();for(t=0;t<n.pageMv.length;t++)if(n.pageMv[t]==e){n.pageMv.splice(t,1);return true}return false},_addMv:function(e){var t=this.data();x._removeMv.call(this,e);t.pageMv.push(e)},_view:function(e){var t=this.data();e=e||t.page;if(t.display=="double")return e%2?[e-1,e]:[e,e+1];else return[e]},view:function(e){var t=this.data(),n=x._view.call(this,e);return t.display=="double"?[n[0]>0?n[0]:0,n[1]<=t.totalPages?n[1]:0]:[n[0]>0&&n[0]<=t.totalPages?n[0]:0]},stop:function(e){var t,n,r=this.data(),i=r.pageMv;r.pageMv=[];if(r.tpage){r.page=r.tpage;delete r["tpage"]}for(t in i){if(!w(t,i))continue;n=r.pages[i[t]].data().f.opts;T._moveFoldingPage.call(r.pages[i[t]],null);r.pages[i[t]].flip("hideFoldedPage");r.pagePlace[n.next]=n.next;if(n.force){n.next=n.page%2===0?n.page-1:n.page+1;delete n["force"]}}this.turn("update");return this},pages:function(e){var t=this.data();if(e){if(e<t.totalPages){for(var n=e+1;n<=t.totalPages;n++)this.turn("removePage",n);if(this.turn("page")>e)this.turn("page",e)}t.totalPages=e;return this}else return t.totalPages},_fitPage:function(t,n){var r=this.data(),i=this.turn("view",t);if(r.page!=t){this.trigger("turning",[t,i]);if(e.inArray(1,i)!=-1)this.trigger("first");if(e.inArray(r.totalPages,i)!=-1)this.trigger("last")}if(!r.pageObjs[t])return;r.tpage=t;this.turn("stop",n);x._removeFromDOM.call(this);x._makeRange.call(this);this.trigger("turned",[t,i])},_turnPage:function(t){var n,r,i=this.data(),s=this.turn("view"),o=this.turn("view",t);if(i.page!=t){this.trigger("turning",[t,o]);if(e.inArray(1,o)!=-1)this.trigger("first");if(e.inArray(i.totalPages,o)!=-1)this.trigger("last")}if(!i.pageObjs[t])return;i.tpage=t;this.turn("stop");x._makeRange.call(this);if(i.display=="single"){n=s[0];r=o[0]}else if(s[1]&&t>s[1]){n=s[1];r=o[0]}else if(s[0]&&t<s[0]){n=s[0];r=o[1]}if(i.pages[n]){var u=i.pages[n].data().f.opts;i.tpage=r;if(u.next!=r){u.next=r;i.pagePlace[r]=u.page;u.force=true}if(i.display=="single")i.pages[n].flip("turnPage",o[0]>s[0]?"br":"bl");else i.pages[n].flip("turnPage")}},page:function(t){t=parseInt(t,10);var n=this.data();if(t>0&&t<=n.totalPages){if(!n.done||e.inArray(t,this.turn("view"))!=-1)x._fitPage.call(this,t);else x._turnPage.call(this,t);return this}else return n.page},next:function(){var e=this.data();return this.turn("page",x._view.call(this,e.page).pop()+1)},previous:function(){var e=this.data();return this.turn("page",x._view.call(this,e.page).shift()-1)},_addMotionPage:function(){var t=e(this).data().f.opts,n=t.turn,r=n.data();t.pageMv=t.page;x._addMv.call(n,t.pageMv);r.pagePlace[t.next]=t.page;n.turn("update")},_start:function(t,n,r){var i=n.turn.data(),s=e.Event("start");t.stopPropagation();n.turn.trigger(s,[n,r]);if(s.isDefaultPrevented()){t.preventDefault();return}if(i.display=="single"){var o=r.charAt(1)=="l";if(n.page==1&&o||n.page==i.totalPages&&!o)t.preventDefault();else{if(o){n.next=n.next<n.page?n.next:n.page-1;n.force=true}else n.next=n.next>n.page?n.next:n.page+1}}x._addMotionPage.call(this)},_end:function(t,n){var r=e(this),i=r.data().f,s=i.opts,o=s.turn,u=o.data();t.stopPropagation();if(n||u.tpage){if(u.tpage==s.next||u.tpage==s.page){delete u["tpage"];x._fitPage.call(o,u.tpage||s.next,true)}}else{x._removeMv.call(o,s.pageMv);o.turn("update")}},_pressed:function(){var t,n=e(this),r=n.data().f,i=r.opts.turn,s=i.data().pages;for(t in s)if(t!=r.opts.page)s[t].flip("disable",true);return r.time=(new Date).getTime()},_released:function(t,n){var r=e(this),i=r.data().f;t.stopPropagation();if((new Date).getTime()-i.time<200||n.x<0||n.x>e(this).width()){t.preventDefault();i.opts.turn.data().tpage=i.opts.next;i.opts.turn.turn("update");e(r).flip("turnPage")}},_flip:function(){var t=e(this).data().f.opts;t.turn.trigger("turn",[t.next])},calculateZ:function(e){var t,n,r,i,s,o=this,u=this.data(),a=this.turn("view"),f=a[0]||a[1],l={pageZ:{},partZ:{},pageV:{}},c=function(e){var t=o.turn("view",e);if(t[0])l.pageV[t[0]]=true;if(t[1])l.pageV[t[1]]=true};for(t=0;t<e.length;t++){n=e[t];r=u.pages[n].data().f.opts.next;i=u.pagePlace[n];c(n);c(r);s=u.pagePlace[r]==r?r:n;l.pageZ[s]=u.totalPages-Math.abs(f-s);l.partZ[i]=u.totalPages*2+Math.abs(f-s)}return l},update:function(){var e,t=this.data();if(t.pageMv.length&&t.pageMv[0]!==0){var n,r=this.turn("calculateZ",t.pageMv),i=this.turn("view",t.tpage);if(t.pagePlace[i[0]]==i[0])n=i[0];else if(t.pagePlace[i[1]]==i[1])n=i[1];for(e in t.pageWrap){if(!w(e,t.pageWrap))continue;t.pageWrap[e].css({display:r.pageV[e]?"":"none","z-index":r.pageZ[e]||0});if(t.pages[e]){t.pages[e].flip("z",r.partZ[e]||null);if(r.pageV[e])t.pages[e].flip("resize");if(t.tpage)t.pages[e].flip("disable",true)}}}else{for(e in t.pageWrap){if(!w(e,t.pageWrap))continue;var s=x._setPageLoc.call(this,e);if(t.pages[e])t.pages[e].flip("disable",t.disabled||s!=1).flip("z",null)}}},_setPageLoc:function(e){var t=this.data(),n=this.turn("view");if(e==n[0]||e==n[1]){t.pageWrap[e].css({"z-index":t.totalPages,display:""});return 1}else if(t.display=="single"&&e==n[0]+1||t.display=="double"&&e==n[0]-2||e==n[1]+2){t.pageWrap[e].css({"z-index":t.totalPages-1,display:""});return 2}else{t.pageWrap[e].css({"z-index":0,display:"none"});return 0}}},T={init:function(e){if(e.gradients){e.frontGradient=true;e.backGradient=true}this.data({f:{}});this.flip("options",e);T._addPageWrapper.call(this);return this},setData:function(t){var n=this.data();n.f=e.extend(n.f,t);return this},options:function(t){var n=this.data().f;if(t){T.setData.call(this,{opts:e.extend({},n.opts||l,t)});return this}else return n.opts},z:function(e){var t=this.data().f;t.opts["z-index"]=e;t.fwrapper.css({"z-index":e||parseInt(t.parent.css("z-index"),10)||0});return this},_cAllowed:function(){return u[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(t){if(t.originalEvent===undefined){return false}t=s?t.originalEvent.touches:[t];var n=this.data().f,r=n.parent.offset(),i=this.width(),o=this.height(),u={x:Math.max(0,t[0].pageX-r.left),y:Math.max(0,t[0].pageY-r.top)},a=n.opts.cornerSize,f=T._cAllowed.call(this);if(u.x<=0||u.y<=0||u.x>=i||u.y>=o)return false;if(u.y<a)u.corner="t";else if(u.y>=o-a)u.corner="b";else return false;if(u.x<=a)u.corner+="l";else if(u.x>=i-a)u.corner+="r";else return false;return e.inArray(u.corner,f)==-1?false:u},_c:function(e,t){t=t||0;return{tl:g(t,t),tr:g(this.width()-t,t),bl:g(t,this.height()-t),br:g(this.width()-t,this.height()-t)}[e]},_c2:function(e){return{tl:g(this.width()*2,0),tr:g(-this.width(),0),bl:g(this.width()*2,this.height()),br:g(-this.width(),this.height())}[e]},_foldingPage:function(e){var t=this.data().f.opts;if(t.folding)return t.folding;else if(t.turn){var n=t.turn.data();if(n.display=="single")return n.pageObjs[t.next]?n.pageObjs[0]:null;else return n.pageObjs[t.next]}},_backGradient:function(){var t=this.data().f,n=t.opts.turn,r=t.opts.backGradient&&(!n||n.data().display=="single"||t.opts.page!=2&&t.opts.page!=n.data().totalPages-1);if(r&&!t.bshadow)t.bshadow=e("<div/>",p(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(t.parent);return r},resize:function(e){var t=this.data().f,n=this.width(),r=this.height(),i=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(r,2)));if(e){t.wrapper.css({width:i,height:i});t.fwrapper.css({width:i,height:i}).children(":first-child").css({width:n,height:r});t.fpage.css({width:r,height:n});if(t.opts.frontGradient)t.ashadow.css({width:r,height:n});if(T._backGradient.call(this))t.bshadow.css({width:n,height:r})}if(t.parent.is(":visible")){t.fwrapper.css({top:t.parent.offset().top,left:t.parent.offset().left});if(t.opts.turn)t.fparent.css({top:-t.opts.turn.offset().top,left:-t.opts.turn.offset().left})}this.flip("z",t.opts["z-index"])},_addPageWrapper:function(){var t,n=this.data().f,r=this.parent();if(!n.wrapper){var i=this.css("left"),s=this.css("top"),o=this.width(),u=this.height(),a=Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(u,2)));n.parent=r;n.fparent=n.opts.turn?n.opts.turn.data().fparent:e("#turn-fwrappers");if(!n.fparent){var f=e("<div/>",{css:{"pointer-events":"none"}}).hide();f.data().flips=0;if(n.opts.turn){f.css(p(-n.opts.turn.offset().top,-n.opts.turn.offset().left,"auto","visible").css).appendTo(n.opts.turn);n.opts.turn.data().fparent=f}else{f.css(p(0,0,"auto","visible").css).attr("id","turn-fwrappers").appendTo(e("body"))}n.fparent=f}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});n.wrapper=e("<div/>",p(0,0,this.css("z-index"))).appendTo(r).prepend(this);n.fwrapper=e("<div/>",p(r.offset().top,r.offset().left)).hide().appendTo(n.fparent);n.fpage=e("<div/>",{css:{cursor:"default"}}).appendTo(e("<div/>",p(0,0,0,"visible")).appendTo(n.fwrapper));if(n.opts.frontGradient)n.ashadow=e("<div/>",p(0,0,1)).appendTo(n.fpage);T.setData.call(this,n);T.resize.call(this,true)}},_fold:function(e){var t=this,n=0,s=0,o,u,a,f,l,c,h,p=g(0,0),d=g(0,0),v=g(0,0),w=this.width(),E=this.height(),x=T._foldingPage.call(this),N=Math.tan(s),C=this.data().f,k=C.opts.acceleration,L=C.wrapper.height(),A=T._c.call(this,e.corner),O=e.corner.substr(0,1)=="t",M=e.corner.substr(1,1)=="l",_=function(){var o=g(A.x?A.x-e.x:e.x,A.y?A.y-e.y:e.y),y=Math.atan2(o.y,o.x),b;s=i-y;n=m(s);b=g(M?w-o.x/2:e.x+o.x/2,o.y/2);var S=s-Math.atan2(b.y,b.x),x=Math.max(0,Math.sin(S)*Math.sqrt(Math.pow(b.x,2)+Math.pow(b.y,2)));v=g(x*Math.sin(s),x*Math.cos(s));if(s>i){v.x=v.x+Math.abs(v.y*Math.tan(y));v.y=0;if(Math.round(v.x*Math.tan(r-s))<E){e.y=Math.sqrt(Math.pow(E,2)+2*b.x*o.x);if(O)e.y=E-e.y;return _()}}if(s>i){var N=r-s,k=L-E/Math.sin(N);p=g(Math.round(k*Math.cos(N)),Math.round(k*Math.sin(N)));if(M)p.x=-p.x;if(O)p.y=-p.y}u=Math.round(v.y/Math.tan(s)+v.x);var D=w-u,P=D*Math.cos(s*2),H=D*Math.sin(s*2);d=g(Math.round(M?D-P:u+P),Math.round(O?H:E-H));c=D*Math.sin(s);var B=T._c2.call(t,e.corner),j=Math.sqrt(Math.pow(B.x-e.x,2)+Math.pow(B.y-e.y,2));h=j<w?j/w:1;if(C.opts.frontGradient){l=c>100?(c-100)/c:0;a=g(c*Math.sin(i-s)/E*100,c*Math.cos(i-s)/w*100);if(O)a.y=100-a.y;if(M)a.x=100-a.x}if(T._backGradient.call(t)){f=g(c*Math.sin(s)/w*100,c*Math.cos(s)/E*100);if(!M)f.x=100-f.x;if(!O)f.y=100-f.y}v.x=Math.round(v.x);v.y=Math.round(v.y);return true},D=function(e,n,r,i){var o=["0","auto"],u=(w-L)*r[0]/100,c=(E-L)*r[1]/100,v={left:o[n[0]],top:o[n[1]],right:o[n[2]],bottom:o[n[3]]},m=i!=90&&i!=-90?M?-1:1:0;r=r[0]+"% "+r[1]+"%";t.css(v).transform(b(i)+y(e.x+m,e.y,k),r);C.fpage.parent().css(v);C.wrapper.transform(y(-e.x+u-m,-e.y+c,k)+b(-i),r);C.fwrapper.transform(y(-e.x+p.x+u,-e.y+p.y+c,k)+b(-i),r);C.fpage.parent().transform(b(i)+y(e.x+d.x-p.x,e.y+d.y-p.y,k),r);if(C.opts.frontGradient)S(C.ashadow,g(M?100:0,O?100:0),g(a.x,a.y),[[l,"rgba(0,0,0,0)"],[(1-l)*.8+l,"rgba(0,0,0,"+.2*h+")"],[1,"rgba(255,255,255,"+.2*h+")"]],3,s);if(T._backGradient.call(t))S(C.bshadow,g(M?0:100,O?0:100),g(f.x,f.y),[[.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+.3*h+")"],[1,"rgba(0,0,0,0)"]],3)};switch(e.corner){case"tl":e.x=Math.max(e.x,1);_();D(v,[1,0,0,1],[100,0],n);C.fpage.transform(y(-E,-w,k)+b(90-n*2),"100% 100%");x.transform(b(90)+y(0,-E,k),"0% 0%");break;case"tr":e.x=Math.min(e.x,w-1);_();D(g(-v.x,v.y),[0,0,0,1],[0,0],-n);C.fpage.transform(y(0,-w,k)+b(-90+n*2),"0% 100%");x.transform(b(270)+y(-w,0,k),"0% 0%");break;case"bl":e.x=Math.max(e.x,1);_();D(g(v.x,-v.y),[1,1,0,0],[100,100],-n);C.fpage.transform(y(-E,0,k)+b(-90+n*2),"100% 0%");x.transform(b(270)+y(-w,0,k),"0% 0%");break;case"br":e.x=Math.min(e.x,w-1);_();D(g(-v.x,-v.y),[0,1,1,0],[0,100],n);C.fpage.transform(b(90-n*2),"0% 0%");x.transform(b(90)+y(0,-E,k),"0% 0%");break}C.point=e},_moveFoldingPage:function(e){var t=this.data().f,n=T._foldingPage.call(this);if(n){if(e){if(!t.fpage.children()[t.ashadow?"1":"0"]){T.setData.call(this,{backParent:n.parent()});t.fpage.prepend(n)}}else{if(t.backParent)t.backParent.prepend(n)}}},_showFoldedPage:function(t,n){var r=T._foldingPage.call(this),i=this.data(),s=i.f;if(!s.point||s.point.corner!=t.corner){var o=e.Event("start");this.trigger(o,[s.opts,t.corner]);if(o.isDefaultPrevented())return false}if(r){if(n){var u=this,a=s.point&&s.point.corner==t.corner?s.point:T._c.call(this,t.corner,1);this.animatef({from:[a.x,a.y],to:[t.x,t.y],duration:500,frame:function(e){t.x=Math.round(e[0]);t.y=Math.round(e[1]);T._fold.call(u,t)}})}else{T._fold.call(this,t);if(i.effect&&!i.effect.turning)this.animatef(false)}if(!s.fwrapper.is(":visible")){s.fparent.show().data().flips++;T._moveFoldingPage.call(this,true);s.fwrapper.show();if(s.bshadow)s.bshadow.show()}return true}return false},hide:function(){var e=this.data().f,t=T._foldingPage.call(this);if(--e.fparent.data().flips===0)e.fparent.hide();this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("","0% 100%");e.wrapper.transform("","0% 100%");e.fwrapper.hide();if(e.bshadow)e.bshadow.hide();t.transform("","0% 0%");return this},hideFoldedPage:function(e){var t=this.data().f;if(!t.point)return;var n=this,r=t.point,i=function(){t.point=null;n.flip("hide");n.trigger("end",[false])};if(e){var s=T._c.call(this,r.corner),o=r.corner.substr(0,1)=="t",u=o?Math.min(0,r.y-s.y)/2:Math.max(0,r.y-s.y)/2,a=g(r.x,r.y+u),f=g(s.x,s.y-u);this.animatef({from:0,to:1,frame:function(e){var t=d(r,a,f,s,e);r.x=t.x;r.y=t.y;T._fold.call(n,r)},complete:i,duration:800,hiding:true})}else{this.animatef(false);i()}},turnPage:function(e){var t=this,n=this.data().f;e={corner:n.corner?n.corner.corner:e||T._cAllowed.call(this)[0]};var r=n.point||T._c.call(this,e.corner,n.opts.turn?n.opts.turn.data().opts.elevation:0),i=T._c2.call(this,e.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(n){var s=d(r,r,i,i,n);e.x=s.x;e.y=s.y;T._showFoldedPage.call(t,e)},complete:function(){t.trigger("end",[true])},duration:n.opts.duration,turning:true});n.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(e){var t=this.data().f;if(!t.disabled&&!this.flip("isTurning")){t.corner=T._cornerActivated.call(this,e);if(t.corner&&T._foldingPage.call(this,t.corner)){T._moveFoldingPage.call(this,true);this.trigger("pressed",[t.point]);return false}else t.corner=null}},_eventMove:function(e){var t=this.data().f;if(!t.disabled){e=s?e.originalEvent.touches:[e];if(t.corner){var n=t.parent.offset();t.corner.x=e[0].pageX-n.left;t.corner.y=e[0].pageY-n.top;T._showFoldedPage.call(this,t.corner)}else if(!this.data().effect&&this.is(":visible")){var r=T._cornerActivated.call(this,e[0]);if(r){var i=T._c.call(this,r.corner,t.opts.cornerSize/2);r.x=i.x;r.y=i.y;T._showFoldedPage.call(this,r,true)}else T.hideFoldedPage.call(this,true)}}},_eventEnd:function(){var t=this.data().f;if(!t.disabled&&t.point){var n=e.Event("released");this.trigger(n,[t.point]);if(!n.isDefaultPrevented())T.hideFoldedPage.call(this,true)}t.corner=null},disable:function(e){T.setData.call(this,{disabled:e});return this}},N=function(e,t,n){if(!n[0]||typeof n[0]=="object")return t.init.apply(e,n);else if(t[n[0]]&&n[0].toString().substr(0,1)!="_")return t[n[0]].apply(e,Array.prototype.slice.call(n,1));else throw n[0]+" is an invalid value"};e.extend(e.fn,{flip:function(e,t){return N(this,T,arguments)},turn:function(e){return N(this,x,arguments)},transform:function(e,t){var r={};if(t)r[n+"transform-origin"]=t;r[n+"transform"]=e;return this.css(r)},animatef:function(e){var t=this.data();if(t.effect)clearInterval(t.effect.handle);if(e){if(!e.to.length)e.to=[e.to];if(!e.from.length)e.from=[e.from];if(!e.easing)e.easing=function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n};var n,r=[],i=e.to.length,s=this,o=e.fps||30,u=-o,a=function(){var n,a=[];u=Math.min(e.duration,u+o);for(n=0;n<i;n++)a.push(e.easing(1,u,e.from[n],r[n],e.duration));e.frame(i==1?a[0]:a);if(u==e.duration){clearInterval(t.effect.handle);delete t["effect"];s.data(t);if(e.complete)e.complete()}};for(n=0;n<i;n++)r.push(e.to[n]-e.from[n]);t.effect=e;t.effect.handle=setInterval(a,o);this.data(t);a()}else{delete t["effect"]}}});e.isTouch=s})(jQuery)